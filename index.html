<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vocabulary Animal Crossing</title>
    <style>
        :root {
            --primary-color: #26c6da; 
            --secondary-color: #f7f9e3; 
            --accent-color: #ffca28; 
            --text-color: #5d4037; 
            --card-bg: #ffffff;
            --success: #66bb6a;
            --danger: #ef5350;
        }

        body {
            font-family: 'Varela Round', 'Segoe UI', Tahoma, sans-serif;
            background-color: var(--secondary-color);
            color: var(--text-color);
            margin: 0;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding-bottom: 80px;
        }

        /* --- é ‚éƒ¨è³‡è¨Šåˆ— --- */
        .top-bar {
            width: 100%;
            max-width: 600px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            padding: 10px 20px;
            border-radius: 30px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            box-sizing: border-box;
        }

        .coin-display {
            display: flex;
            align-items: center;
            font-weight: bold;
            font-size: 1.2em;
            color: #fbc02d;
            background: #fff9c4;
            padding: 5px 15px;
            border-radius: 20px;
        }

        .coin-icon { margin-right: 5px; }

        /* --- è§’è‰²é¡¯ç¤ºå€ (Avatar - Paper Doll System) --- */
        .avatar-container {
            width: 220px; /* è¨­å®šåˆé©çš„é¡¯ç¤ºå¤§å° */
            height: 220px;
            position: relative;
            margin: 0 auto 20px;
            background: #e0f7fa; /* æ·ºè—èƒŒæ™¯ */
            border-radius: 20px;
            overflow: hidden;
            border: 5px solid white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        /* æ‰€æœ‰åœ–å±¤é€šç”¨è¨­å®š */
        .avatar-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain; /* ä¿æŒåœ–ç‰‡æ¯”ä¾‹ */
            pointer-events: none; /* è®“é»æ“Šäº‹ä»¶å¯ä»¥ç©¿é€åœ–ç‰‡ */
        }

        /* åœ–å±¤å †ç–Šé †åº (Z-Index) - é—œéµï¼ */
        .layer-base  { z-index: 1; }   /* èº«é«”æœ€ä¸‹é¢ */
        .layer-shirt { z-index: 2; }   /* è¡£æœåœ¨ä¸­é–“ */
        .layer-hair  { z-index: 3; }   /* é ­é«®è“‹åœ¨è¡£æœä¸Š (é•·é«®è¨­å®š) */
        .layer-hat   { z-index: 4; }   /* å¸½å­æœ€ä¸Šé¢ */
        
        /* --- é€±æ•¸é¸æ“‡ --- */
        .week-selector-container { margin-bottom: 15px; }
        select {
            padding: 8px 15px;
            border-radius: 20px;
            border: 2px solid var(--primary-color);
            background: white;
            font-weight: bold;
            color: var(--text-color);
        }

        /* --- ä¸»è¦å…§å®¹å€å¡Š --- */
        .section {
            display: none;
            width: 100%;
            max-width: 600px;
            animation: fadeIn 0.3s;
        }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- å•†åº—æ¨£å¼ --- */
        .shop-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        .shop-item {
            background: white;
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 3px 6px rgba(0,0,0,0.05);
            cursor: pointer;
            transition: 0.2s;
            border: 2px solid transparent;
        }
        .shop-item:hover { transform: translateY(-3px); }
        .shop-item.owned { border-color: #ddd; opacity: 0.8; background: #f9f9f9; }
        .shop-item.equipped { border-color: var(--primary-color); background: #e0f7fa; opacity: 1; }
        
        .price-tag {
            background: var(--accent-color);
            color: white;
            padding: 3px 10px;
            border-radius: 10px;
            font-size: 0.8em;
            display: inline-block;
        }

        /* --- å­¸ç¿’å¡ç‰‡æ¨£å¼ --- */
        .word-item {
            background: white;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        .word-title { font-size: 1.5em; font-weight: 800; color: var(--primary-color); }
        
        .flashcard-container {
            perspective: 1000px;
            height: 280px;
            margin-bottom: 20px;
            cursor: pointer;
        }
        .flashcard {
            width: 100%; height: 100%; position: relative;
            transition: transform 0.6s; transform-style: preserve-3d;
            box-shadow: 0 8px 20px rgba(100,100,100,0.1); border-radius: 25px;
        }
        .flashcard.flipped { transform: rotateY(180deg); }
        .card-face {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden; display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            background: white; border-radius: 25px; padding: 20px; box-sizing: border-box; text-align: center;
        }
        .card-back { transform: rotateY(180deg); background: #fffbe7; border: 3px solid #fff176; }

        /* --- æ¸¬é©—æ¨£å¼ --- */
        .quiz-container { background: white; padding: 25px; border-radius: 25px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .option-btn {
            width: 100%; padding: 15px; margin-top: 10px;
            border: 2px solid #eee; border-radius: 15px; background: white;
            font-size: 1.1em; cursor: pointer; transition: 0.2s; color: var(--text-color);
        }
        .option-btn:hover { background: #f5f5f5; }
        .option-btn.correct { background: #dcedc8; border-color: #8bc34a; color: #33691e; }
        .option-btn.wrong { background: #ffcdd2; border-color: #e57373; color: #b71c1c; }

        .spelling-word {
            font-family: 'Courier New', monospace; font-size: 2em; letter-spacing: 5px;
            background: #f1f8e9; padding: 15px; border-radius: 10px; display: inline-block; margin-bottom: 15px;
        }
        .spelling-options { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

        /* --- åº•éƒ¨å°èˆªåˆ— --- */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: white; display: flex; justify-content: space-around;
            padding: 10px 0; border-radius: 20px 20px 0 0;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.05); z-index: 100;
        }
        .nav-item { text-align: center; cursor: pointer; color: #aaa; flex: 1; }
        .nav-item.active { color: var(--primary-color); font-weight: bold; }
        .nav-icon { font-size: 1.5em; display: block; margin-bottom: 3px; }
        .nav-text { font-size: 0.8em; }

        /* é‡‘å¹£å‹•ç•« */
        @keyframes coinPop {
            0% { transform: scale(1); }
            50% { transform: scale(1.5); }
            100% { transform: scale(1); }
        }
        .coin-anim { animation: coinPop 0.3s ease; }

    </style>
</head>
<body>

    <!-- é ‚éƒ¨ï¼šé‡‘å¹£èˆ‡é€±æ•¸ -->
    <div class="top-bar">
        <div class="week-selector-container">
            <select id="week-selector" onchange="changeWeek()">
                <option value="13">Week 13</option>
                <option value="14">Week 14</option>
                <option value="15">Week 15</option>
                <option value="16">Week 16</option>
                <option value="17">Week 17</option>
            </select>
        </div>
        <div class="coin-display" id="coin-display">
            <span class="coin-icon">ğŸ’°</span>
            <span id="coin-count">0</span>
        </div>
    </div>

    <!-- è§’è‰²å±•ç¤ºå€ (æ›´æ–°ç‚ºåœ–ç‰‡ç–ŠåŠ æ¨¡å¼) -->
    <div class="avatar-container" onclick="showSection('shop')">
        <!-- 1. ç´ é«” (æœ€ä¸‹å±¤) -->
        <img id="img-base" class="avatar-layer layer-base" src="" onerror="this.style.display='none'">
        
        <!-- 2. è¡£æœ (ä¸­é–“å±¤) -->
        <img id="img-shirt" class="avatar-layer layer-shirt" src="" onerror="this.style.display='none'">
        
        <!-- 3. é ­é«® (é•·é«®è“‹åœ¨è¡£æœä¸Š) -->
        <img id="img-hair" class="avatar-layer layer-hair" src="" onerror="this.style.display='none'">

        <!-- 4. å¸½å­ (æœ€ä¸Šå±¤) -->
        <img id="img-hat" class="avatar-layer layer-hat" src="" onerror="this.style.display='none'">
    </div>

    <!-- 1. Home / List View -->
    <div id="section-home" class="section active">
        <div id="word-list-container"></div>
    </div>

    <!-- 2. Flashcards -->
    <div id="section-card" class="section">
        <div class="flashcard-container" onclick="flipCard()">
            <div class="flashcard" id="flashcard">
                <div class="card-face card-front">
                    <div id="fc-word" class="fc-word-text" style="font-size: 2.5em; font-weight:bold; color:var(--primary-color)">Word</div>
                    <div id="fc-pos" style="color:#888">(n.)</div>
                    <div style="font-size: 0.8em; color: #ccc; margin-top: auto;">Tap to flip</div>
                </div>
                <div class="card-face card-back">
                    <div id="fc-def" style="font-weight:bold; font-size:1.2em">Def</div>
                    <div id="fc-ex" style="font-style:italic; margin-top:10px; font-size:0.9em">Ex</div>
                </div>
            </div>
        </div>
        <div style="display:flex; justify-content:center; gap:20px; margin-top:20px;">
            <button class="option-btn" style="width:auto" onclick="prevCard()">â†</button>
            <button class="option-btn" style="width:auto" onclick="speakCurrentCard()">ğŸ”Š Listen</button>
            <button class="option-btn" style="width:auto" onclick="nextCard()">â†’</button>
        </div>
    </div>

    <!-- 3. Quiz Mode -->
    <div id="section-quiz" class="section">
        <div class="quiz-container">
            <h3>Meaning Quiz</h3>
            <div style="color:#666; margin-bottom:10px;">Earn <span style="color:orange; font-weight:bold;">10 Coins</span> per correct answer!</div>
            <div id="quiz-question" style="font-size:1.2em; font-weight:bold; margin:20px 0;">Question</div>
            <div id="quiz-options"></div>
            <div id="quiz-feedback" class="feedback-msg" style="height:20px;"></div>
            <button onclick="generateQuiz()" class="option-btn" style="background:var(--primary-color); color:white; border:none; margin-top:20px;">Next Question</button>
        </div>
    </div>

    <!-- 4. Spelling Mode -->
    <div id="section-spelling" class="section">
        <div class="quiz-container">
            <h3>Spelling Practice</h3>
            <div style="color:#666; margin-bottom:10px;">Earn <span style="color:orange; font-weight:bold;">20 Coins</span>!</div>
            <div id="spelling-display" class="spelling-word">_ _ _ _</div>
            <div id="spelling-options" class="spelling-options"></div>
            <div id="spelling-feedback" class="feedback-msg" style="height:20px; margin-top:10px;"></div>
            <button onclick="generateSpellingQuiz()" class="option-btn" style="background:var(--primary-color); color:white; border:none; margin-top:20px;">Next Word</button>
        </div>
    </div>

    <!-- 5. Shop -->
    <div id="section-shop" class="section">
        <h2 style="text-align:center; color:var(--text-color)">ğŸ‘— Clothing Shop</h2>
        <p style="text-align:center; font-size:0.9em; color:#888">Customize your character!</p>
        
        <h3 style="margin-left:10px;">Shirts</h3>
        <div class="shop-grid" id="shop-shirts"></div>
        
        <h3 style="margin-left:10px; margin-top:20px;">Hats</h3>
        <div class="shop-grid" id="shop-hats"></div>
    </div>

    <!-- åº•éƒ¨å°èˆª -->
    <div class="bottom-nav">
        <div class="nav-item active" onclick="showSection('home', this)">
            <span class="nav-icon">ğŸ“–</span>
            <span class="nav-text">Study</span>
        </div>
        <div class="nav-item" onclick="showSection('card', this)">
            <span class="nav-icon">ğŸƒ</span>
            <span class="nav-text">Cards</span>
        </div>
        <div class="nav-item" onclick="showSection('quiz', this)">
            <span class="nav-icon">â“</span>
            <span class="nav-text">Quiz</span>
        </div>
        <div class="nav-item" onclick="showSection('spelling', this)">
            <span class="nav-icon">âœï¸</span>
            <span class="nav-text">Spell</span>
        </div>
        <div class="nav-item" onclick="showSection('shop', this)">
            <span class="nav-icon">ğŸ‘•</span>
            <span class="nav-text">Shop</span>
        </div>
    </div>

    <!-- è¼‰å…¥è³‡æ–™åº« -->
    <script src="week13_data.js"></script>
    <script src="week14_data.js"></script>
    <script src="week15_data.js"></script>
    <script src="week16_data.js"></script>
    <script src="week17_data.js"></script>
    <!-- è¼‰å…¥å•†åº—è³‡æ–™åº« -->
    <script src="shop_data.js"></script>

    <script>
        // --- 1. å…¨åŸŸè®Šæ•¸èˆ‡å­˜æª”ç³»çµ± ---
        let vocabData = []; 
        let currentCardIndex = 0;
        
        // é è¨­çš„ä½¿ç”¨è€…è³‡æ–™ (æ³¨æ„ï¼šé€™è£¡çš„ ID å¿…é ˆè·Ÿ shop_data.js å°æ‡‰)
        let userProfile = {
            coins: 0,
            ownedItems: ['shirt_default', 'hat_none'], 
            equipped: {
                shirt: 'shirt_default',
                hat: 'hat_none'
            }
        };

        // è®€å–å­˜æª”
        function loadProfile() {
            const saved = localStorage.getItem('esl_user_profile');
            if (saved) {
                userProfile = JSON.parse(saved);
            }
            // ç¢ºä¿ shopData å·²ç¶“è¼‰å…¥ï¼Œå†æ›´æ–° UI
            if (typeof shopData !== 'undefined') {
                updateUI();
            } else {
                console.error("shop_data.js not loaded!");
            }
        }

        // å„²å­˜å­˜æª”
        function saveProfile() {
            localStorage.setItem('esl_user_profile', JSON.stringify(userProfile));
            updateUI();
        }

        // æ›´æ–°ä»‹é¢ (é‡‘å¹£ã€è§’è‰²åœ–ç‰‡)
        function updateUI() {
            document.getElementById('coin-count').innerText = userProfile.coins;

            // 1. è¨­å®šç´ é«”èˆ‡é ­é«®
            // å…ˆæª¢æŸ¥æœ‰æ²’æœ‰è³‡æ–™ï¼Œæœ‰æ‰è¨­å®šï¼Œé¿å…å ±éŒ¯
            if (shopData.base) {
                const baseEl = document.getElementById('img-base');
                baseEl.src = shopData.base;
                baseEl.style.display = 'block';
            }
            if (shopData.hair) {
                const hairEl = document.getElementById('img-hair');
                hairEl.src = shopData.hair;
                hairEl.style.display = 'block';
            }

            // 2. æ‰¾å‡ºç›®å‰ç©¿è‘—çš„è¡£æœèˆ‡å¸½å­
            const currentShirt = shopData.shirts.find(i => i.id === userProfile.equipped.shirt);
            const currentHat = shopData.hats.find(i => i.id === userProfile.equipped.hat);

            // 3. æ›´æ–°è¡£æœåœ–ç‰‡
            const shirtEl = document.getElementById('img-shirt');
            if (currentShirt && currentShirt.img) {
                shirtEl.src = currentShirt.img;
                shirtEl.style.display = 'block';
            } else {
                // å¦‚æœæ²’æœ‰åœ–ç‰‡ï¼Œéš±è—ä¸¦æ¸…ç©º src ä»¥å… iPad é¡¯ç¤ºé‚Šæ¡†
                shirtEl.style.display = 'none';
                shirtEl.src = ''; 
            }

            // 4. æ›´æ–°å¸½å­åœ–ç‰‡
            const hatEl = document.getElementById('img-hat');
            if (currentHat && currentHat.img) {
                hatEl.src = currentHat.img;
                hatEl.style.display = 'block';
            } else {
                hatEl.style.display = 'none';
                hatEl.src = '';
            }

            // é‡æ–°æ¸²æŸ“å•†åº—ç‹€æ…‹
            renderShop();
        }

        function addCoins(amount) {
            userProfile.coins += amount;
            saveProfile();
            
            const display = document.getElementById('coin-display');
            display.classList.remove('coin-anim');
            void display.offsetWidth; 
            display.classList.add('coin-anim');
        }

        // --- 2. å•†åº—ç³»çµ± (åœ–ç‰‡ç‰ˆ) ---
        function renderShop() {
            // è¼”åŠ©å‡½å¼ï¼šç”¢ç”Ÿå•†å“åˆ—è¡¨
            const renderCategory = (items, containerId, type) => {
                const container = document.getElementById(containerId);
                container.innerHTML = '';
                
                if (!items) return;

                items.forEach(item => {
                    const isOwned = userProfile.ownedItems.includes(item.id);
                    const isEquipped = userProfile.equipped[type] === item.id;
                    
                    const div = document.createElement('div');
                    div.className = `shop-item ${isOwned ? 'owned' : ''} ${isEquipped ? 'equipped' : ''}`;
                    div.onclick = () => handleItemClick(item, type);
                    
                    // åœ–ç‰‡é è¦½å€åŸŸ
                    let previewHtml = '';
                    if(item.img) {
                        // é¡¯ç¤ºç¸®åœ–
                        previewHtml = `<img src="${item.img}" style="width:60px; height:60px; object-fit:contain;">`;
                    } else {
                        // å¦‚æœæ˜¯ç©ºå­—ä¸² (ä¾‹å¦‚ No Hat)ï¼Œé¡¯ç¤ºæ–‡å­—æˆ–åœ–ç¤º
                        previewHtml = `<div style="width:60px; height:60px; background:#eee; border-radius:10px; line-height:60px; text-align:center; color:#ccc; margin:0 auto;">X</div>`;
                    }

                    div.innerHTML = `
                        ${previewHtml}
                        <div style="font-weight:bold; font-size:0.8em; margin-top:5px;">${item.name}</div>
                        ${isOwned 
                            ? (isEquipped ? '<span style="color:green; font-size:0.8em">Equipped</span>' : '<span style="color:#888; font-size:0.8em">Owned</span>') 
                            : `<div class="price-tag">ğŸ’° ${item.price}</div>`
                        }
                    `;
                    container.appendChild(div);
                });
            };

            renderCategory(shopData.shirts, 'shop-shirts', 'shirt');
            renderCategory(shopData.hats, 'shop-hats', 'hat');
        }

        function handleItemClick(item, type) {
            if (userProfile.ownedItems.includes(item.id)) {
                // å·²ç¶“æ“æœ‰ -> ç©¿ä¸Š
                userProfile.equipped[type] = item.id;
                saveProfile();
            } else {
                // æœªæ“æœ‰ -> è³¼è²·
                if (userProfile.coins >= item.price) {
                    if(confirm(`Buy ${item.name} for ${item.price} coins?`)) {
                        userProfile.coins -= item.price;
                        userProfile.ownedItems.push(item.id);
                        userProfile.equipped[type] = item.id; // è²·äº†ç›´æ¥ç©¿
                        saveProfile();
                        alert("Thank you for purchase!");
                    }
                } else {
                    alert("Not enough coins! Go study to earn more.");
                }
            }
        }

        // --- 3. é é¢é‚è¼¯ (èˆŠåŠŸèƒ½æ•´åˆ) ---
        
        function changeWeek() {
            const selector = document.getElementById('week-selector');
            const selectedWeek = selector.value;
            
            if (selectedWeek === '13' && typeof week13Data !== 'undefined') vocabData = week13Data;
            else if (selectedWeek === '14' && typeof week14Data !== 'undefined') vocabData = week14Data;
            else if (selectedWeek === '15' && typeof week15Data !== 'undefined') vocabData = week15Data;
            else if (selectedWeek === '16' && typeof week16Data !== 'undefined') vocabData = week16Data;
            else if (selectedWeek === '17' && typeof week17Data !== 'undefined') vocabData = week17Data;
            else { alert("Data missing for this week!"); return; }

            currentCardIndex = 0;
            refreshActiveSection();
        }

        function refreshActiveSection() {
            renderList();
            updateFlashcard();
            const activeSection = document.querySelector('.section.active');
            if (activeSection.id === 'section-quiz') generateQuiz();
            if (activeSection.id === 'section-spelling') generateSpellingQuiz();
        }

        // List
        function renderList() {
            const container = document.getElementById('word-list-container');
            container.innerHTML = '';
            vocabData.forEach(item => {
                const div = document.createElement('div');
                div.className = 'word-item';
                div.innerHTML = `
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div>
                            <span class="word-title">${item.word}</span>
                            <span style="color:#888; margin-left:10px;">${item.pos}</span>
                        </div>
                        <button onclick="speak('${item.word}')" style="background:none; border:1px solid #ddd; border-radius:15px; cursor:pointer;">ğŸ”ˆ</button>
                    </div>
                    <div style="margin-top:10px; font-weight:bold;">${item.def}</div>
                    <div style="margin-top:5px; color:#555; font-style:italic;">${item.ex}</div>
                `;
                container.appendChild(div);
            });
        }

        // Flashcards
        function updateFlashcard() {
            if (vocabData.length === 0) return;
            const item = vocabData[currentCardIndex];
            document.getElementById('fc-word').innerText = item.word;
            document.getElementById('fc-pos').innerText = item.pos;
            document.getElementById('fc-def').innerText = item.def;
            document.getElementById('fc-ex').innerHTML = item.ex;
            document.getElementById('flashcard').classList.remove('flipped');
        }
        function flipCard() { document.getElementById('flashcard').classList.toggle('flipped'); }
        function nextCard() { currentCardIndex = (currentCardIndex + 1) % vocabData.length; updateFlashcard(); }
        function prevCard() { currentCardIndex = (currentCardIndex - 1 + vocabData.length) % vocabData.length; updateFlashcard(); }
        function speakCurrentCard() { speak(vocabData[currentCardIndex].word); }

        // Quiz
        function generateQuiz() {
            document.getElementById('quiz-feedback').innerText = '';
            const correctIndex = Math.floor(Math.random() * vocabData.length);
            const correctItem = vocabData[correctIndex];
            
            let distractors = [];
            while(distractors.length < 3) {
                let idx = Math.floor(Math.random() * vocabData.length);
                if (idx !== correctIndex && !distractors.includes(idx)) distractors.push(idx);
            }
            
            let optionsIndices = [correctIndex, ...distractors].sort(() => Math.random() - 0.5);

            document.getElementById('quiz-question').innerText = `"${correctItem.def}"`;
            const optionsContainer = document.getElementById('quiz-options');
            optionsContainer.innerHTML = '';
            
            optionsIndices.forEach(idx => {
                const item = vocabData[idx];
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerText = item.word;
                btn.onclick = () => checkQuizAnswer(btn, idx === correctIndex, 'quiz-feedback');
                optionsContainer.appendChild(btn);
            });
        }

        function checkQuizAnswer(btn, isCorrect, feedbackId) {
            const feedback = document.getElementById(feedbackId);
            const buttons = btn.parentElement.querySelectorAll('.option-btn');
            buttons.forEach(b => b.disabled = true);

            if (isCorrect) {
                btn.classList.add('correct');
                feedback.innerText = "Correct! +10 Coins ğŸ’°";
                feedback.style.color = "green";
                speak("Correct!"); 
                addCoins(10); 
            } else {
                btn.classList.add('wrong');
                feedback.innerText = "Try again next time!";
                feedback.style.color = "red";
                speak("Try again");
            }
        }

        // Spelling
        function generateSpellingQuiz() {
            document.getElementById('spelling-feedback').innerText = '';
            const randomItem = vocabData[Math.floor(Math.random() * vocabData.length)];
            const word = randomItem.word;
            
            let validIndices = [];
            for (let i = 0; i < word.length; i++) {
                if (/[a-z]/i.test(word[i])) validIndices.push(i);
            }
            
            const hideIndex = validIndices[Math.floor(Math.random() * validIndices.length)];
            const correctChar = word[hideIndex].toLowerCase();
            
            let displayString = "";
            for (let i = 0; i < word.length; i++) {
                if (i === hideIndex) displayString += "_ ";
                else displayString += word[i] + " ";
            }
            document.getElementById('spelling-display').innerText = displayString;

            const alphabet = "abcdefghijklmnopqrstuvwxyz";
            let options = [correctChar];
            while (options.length < 4) {
                const randomChar = alphabet[Math.floor(Math.random() * alphabet.length)];
                if (!options.includes(randomChar)) options.push(randomChar);
            }
            options.sort(() => Math.random() - 0.5);
            
            const container = document.getElementById('spelling-options');
            container.innerHTML = '';
            
            options.forEach(char => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.style.fontWeight = 'bold';
                btn.innerText = char;
                btn.onclick = () => checkSpellingAnswer(btn, char === correctChar, word);
                container.appendChild(btn);
            });
        }

        function checkSpellingAnswer(btn, isCorrect, fullWord) {
            const feedback = document.getElementById('spelling-feedback');
            const buttons = document.querySelectorAll('#spelling-options .option-btn');
            buttons.forEach(b => b.disabled = true);

            window.speechSynthesis.cancel();
            let speechMsg = new SpeechSynthesisUtterance();
            speechMsg.lang = 'en-US';
            speechMsg.text = fullWord;

            if (isCorrect) {
                btn.classList.add('correct');
                feedback.innerText = `Correct! +20 Coins ğŸ’°`;
                feedback.style.color = "green";
                document.getElementById('spelling-display').innerText = fullWord.split('').join(' ');
                addCoins(20); 
            } else {
                btn.classList.add('wrong');
                feedback.innerText = `The word was "${fullWord}".`;
                feedback.style.color = "red";
            }
            window.speechSynthesis.speak(speechMsg);
        }

        function showSection(id, navEl) {
            document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
            document.getElementById(`section-${id}`).classList.add('active');
            
            if(navEl) {
                document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
                navEl.classList.add('active');
            }

            if(id === 'quiz') generateQuiz();
            if(id === 'spelling') generateSpellingQuiz();
        }

        function speak(text) {
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            window.speechSynthesis.speak(utterance);
        }

        window.onload = function() {
            loadProfile(); 
            changeWeek(); 
        }

    </script>
</body>
</html>